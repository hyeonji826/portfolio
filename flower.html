<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>꽃가루 위험지수 조회</title>
  </head>
  <body>
    <h2>꽃가루 위험지수 조회</h2>

    <label for="crop">작물 선택:</label>
    <select id="crop">
      <option value="getPollenRiskIdx">소나무</option>
      <option value="getPollenRiskIdx2">잡초류</option>
      <option value="getPollenRiskIdx3">참나무</option>
    </select>

    <label for="region">지역 선택:</label>
    <select id="region">
      <option value="1100000000">서울</option>
      <option value="4100000000">경기도</option>
      <option value="2600000000">부산</option>
      <!-- 필요시 더 추가 가능 -->
    </select>

    <button onclick="getPollenData()">조회하기</button>

    <div id="result" style="margin-top: 20px"></div>

    <script>
      const proxy = "https://cors-anywhere.herokuapp.com/";
      const apiURL = `https://apis.data.go.kr/1360000/HealthWthrIdxService03/getPinePollenRiskIdxV3?...`;
      const fullURL = proxy + apiURL;

      fetch(fullURL)
        .then((res) => res.json())
        .then((data) => console.log(data))
        .catch((error) => console.error("API Error:", error));

      function getPollenData() {
        const cropApiMap = {
          getPollenRiskIdx: "소나무",
          getPollenRiskIdx2: "잡초류",
          getPollenRiskIdx3: "참나무",
        };

        const serviceKey =
          "fQlPfKnYI5jKgbG0KRQHAE1byN6vF46OBF%2FB7t4svBhp%2F3n%2BvsVBakK322v5yH%2BAJbtMYn5d80ICQgzXelbXbcw%3D%3D";
        const cropApi = document.getElementById("crop").value;
        const areaNo = document.getElementById("region").value;

        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        const day = String(now.getDate()).padStart(2, "0");
        const baseTime = "06";
        const baseDateTime = `${year}년${month}월${day}일${baseTime}시 기준`;

        const url = `https://apis.data.go.kr/1360000/HealthWthrIdxService01/${cropApi}?serviceKey=${serviceKey}&areaNo=${areaNo}&time=${baseDateTime}&numOfRows=10&pageNo=1&dataType=JSON`;

        fetch(url)
          .then((res) => res.json())
          .then((data) => {
            const items = data.response.body.items.item[0];
            const resultDiv = document.getElementById("result");

            resultDiv.innerHTML = `
            <h3>[${cropApiMap[cropApi]} - 꽃가루 위험지수]</h3>
            <p><strong>오늘:</strong> ${items.today}</p>
            <p><strong>내일:</strong> ${items.tomorrow}</p>
            <p><strong>모레:</strong> ${items.dayaftertomorrow}</p>
            <p><strong>글피:</strong> ${items.twodaysaftertomorrow}</p>
          `;
          })
          .catch((error) => {
            document.getElementById("result").innerHTML = "오류입니다.";
            console.error("API Error:", error);
          });
      }
    </script>
  </body>
</html>
